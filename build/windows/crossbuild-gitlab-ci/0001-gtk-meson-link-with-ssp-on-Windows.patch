From b6b16c011def5c9e59ee8317715b4be05e088b9f Mon Sep 17 00:00:00 2001
From: Jehan <jehan@girinstud.io>
Date: Wed, 3 Mar 2021 17:04:16 +0100
Subject: [PATCH] meson: link with ssp on Windows.

Maybe not necessary for all Windows builds, but for the ones with
mingw-w64 at least, since recent versions, -lssp is necessary for
fortified functions access.
---
 gtk/meson.build | 2 +-
 meson.build     | 3 +++
 2 files changed, 4 insertions(+), 1 deletion(-)

diff --git a/gtk/meson.build b/gtk/meson.build
index 43a6e2bfef..41c7e2ee3b 100644
--- a/gtk/meson.build
+++ b/gtk/meson.build
@@ -1092,7 +1092,7 @@ gtk_update_icon_cache = executable(
   'updateiconcache.c',
   extra_update_icon_cache_objs,
   c_args: gtk_cargs,
-  dependencies: libgtk_dep,
+  dependencies: [ libgtk_dep, ssp ],
   install: true
 )
 
diff --git a/meson.build b/meson.build
index 7ea2f4c7dd..c8638a331b 100644
--- a/meson.build
+++ b/meson.build
@@ -801,6 +801,9 @@ if os_win32
   '''
   result = cc.links(getdevprop_code, args: ['-lsetupapi'], name: 'has SetupDiGetDevicePropertyW')
   cdata.set('HAVE_SETUP_DI_GET_DEVICE_PROPERTY_W', result ? 1 : false)
+
+  # Necessary with _FORTIFY_SOURCE on mingw-w64.
+  ssp = cc.find_library('ssp')
 endif
 
 have_gio_unix = false
-- 
2.29.2

